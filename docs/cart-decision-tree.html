<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 CART (Decision Tree) | R algorithm notes</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 CART (Decision Tree) | R algorithm notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 CART (Decision Tree) | R algorithm notes" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Yao-Chung" />


<meta name="date" content="2021-12-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="knn-k-nearest-neighbors.html"/>
<link rel="next" href="model-selection.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="ab-test.html"><a href="ab-test.html"><i class="fa fa-check"></i><b>2</b> A/B test</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ab-test.html"><a href="ab-test.html#scenario"><i class="fa fa-check"></i><b>2.1</b> Scenario</a></li>
<li class="chapter" data-level="2.2" data-path="ab-test.html"><a href="ab-test.html#case-study"><i class="fa fa-check"></i><b>2.2</b> Case study</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="k-means.html"><a href="k-means.html"><i class="fa fa-check"></i><b>3</b> K-means</a>
<ul>
<li class="chapter" data-level="3.1" data-path="k-means.html"><a href="k-means.html#case-1"><i class="fa fa-check"></i><b>3.1</b> Case 1</a></li>
<li class="chapter" data-level="3.2" data-path="k-means.html"><a href="k-means.html#case-2"><i class="fa fa-check"></i><b>3.2</b> Case 2</a></li>
<li class="chapter" data-level="3.3" data-path="k-means.html"><a href="k-means.html#hierarchical-clustering"><i class="fa fa-check"></i><b>3.3</b> Hierarchical clustering</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="knn-k-nearest-neighbors.html"><a href="knn-k-nearest-neighbors.html"><i class="fa fa-check"></i><b>4</b> kNN (k-Nearest Neighbors)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="knn-k-nearest-neighbors.html"><a href="knn-k-nearest-neighbors.html#difference-calculating-the-distance-1-euclidean-2-manhatten-3-cosine-4-jaccard-coefficient-5-minkowski"><i class="fa fa-check"></i><b>4.1</b> Difference calculating the distance: (1) Euclidean (2) Manhatten (3) Cosine (4) Jaccard Coefficient (5) MinKowski</a></li>
<li class="chapter" data-level="4.2" data-path="knn-k-nearest-neighbors.html"><a href="knn-k-nearest-neighbors.html#find-the-k-nearest-neighbors"><i class="fa fa-check"></i><b>4.2</b> Find the k nearest neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cart-decision-tree.html"><a href="cart-decision-tree.html"><i class="fa fa-check"></i><b>5</b> CART (Decision Tree)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cart-decision-tree.html"><a href="cart-decision-tree.html#classification-tree"><i class="fa fa-check"></i><b>5.1</b> Classification Tree</a></li>
<li class="chapter" data-level="5.2" data-path="cart-decision-tree.html"><a href="cart-decision-tree.html#random-forest"><i class="fa fa-check"></i><b>5.2</b> Random Forest</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-selection.html"><a href="model-selection.html"><i class="fa fa-check"></i><b>6</b> Model selection</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-selection.html"><a href="model-selection.html#linear-model"><i class="fa fa-check"></i><b>6.1</b> Linear model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R algorithm notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cart-decision-tree" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> CART (Decision Tree)</h1>
<p>2021-12-25 updated<br />
Ref: <a href="https://www.r-bloggers.com/2021/04/decision-trees-in-r/">here</a><br />
Ref: <a href="https://lgatto.github.io/IntroMachineLearningWithR/supervised-learning.html#scaling-and-centering">random forest</a><br />
Decision Tree can handle classification and regression problem. It is also called CART (Classification and Regression Tree). In the following, we will use spam data and Boston house pricing data to demonstrate.</p>
<div id="classification-tree" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Classification Tree</h2>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="cart-decision-tree.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DAAG) <span class="co"># data sets used in examples and exercise</span></span>
<span id="cb74-2"><a href="cart-decision-tree.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(party) <span class="co"># for recursive partitioning</span></span>
<span id="cb74-3"><a href="cart-decision-tree.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart) <span class="co"># recursive partitioning and regression trees</span></span>
<span id="cb74-4"><a href="cart-decision-tree.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot) <span class="co"># plot rpart models</span></span>
<span id="cb74-5"><a href="cart-decision-tree.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench) <span class="co"># collection of ML benchmark problems</span></span>
<span id="cb74-6"><a href="cart-decision-tree.html#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># Misc functions for training/plotting models</span></span>
<span id="cb74-7"><a href="cart-decision-tree.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb74-8"><a href="cart-decision-tree.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree) <span class="co"># classification and regression tree</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="cart-decision-tree.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting Email spam data</span></span>
<span id="cb75-2"><a href="cart-decision-tree.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(spam7)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4601 obs. of  7 variables:
##  $ crl.tot: num  278 1028 2259 191 191 ...
##  $ dollar : num  0 0.18 0.184 0 0 0 0.054 0 0.203 0.081 ...
##  $ bang   : num  0.778 0.372 0.276 0.137 0.135 0 0.164 0 0.181 0.244 ...
##  $ money  : num  0 0.43 0.06 0 0 0 0 0 0.15 0 ...
##  $ n000   : num  0 0.43 1.16 0 0 0 0 0 0 0.19 ...
##  $ make   : num  0 0.21 0.06 0 0 0 0 0 0.15 0.06 ...
##  $ yesno  : Factor w/ 2 levels &quot;n&quot;,&quot;y&quot;: 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="cart-decision-tree.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data partition</span></span>
<span id="cb77-2"><a href="cart-decision-tree.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb77-3"><a href="cart-decision-tree.html#cb77-3" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> spam7</span>
<span id="cb77-4"><a href="cart-decision-tree.html#cb77-4" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(mydata), <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>)) <span class="co"># assign index</span></span>
<span id="cb77-5"><a href="cart-decision-tree.html#cb77-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> mydata[ind <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb77-6"><a href="cart-decision-tree.html#cb77-6" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> mydata[ind <span class="sc">==</span> <span class="dv">2</span>,]</span>
<span id="cb77-7"><a href="cart-decision-tree.html#cb77-7" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(yesno <span class="sc">~</span> ., <span class="at">data=</span>train)</span>
<span id="cb77-8"><a href="cart-decision-tree.html#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cart-decision-tree.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(tree)</span></code></pre></div>
<pre><code>## 
## Classification tree:
## rpart(formula = yesno ~ ., data = train)
## 
## Variables actually used in tree construction:
## [1] bang    crl.tot dollar 
## 
## Root node error: 900/2305 = 0.39046
## 
## n= 2305 
## 
##         CP nsplit rel error  xerror
## 1 0.474444      0   1.00000 1.00000
## 2 0.074444      1   0.52556 0.56556
## 3 0.010000      3   0.37667 0.42111
##       xstd
## 1 0.026024
## 2 0.022128
## 3 0.019773</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="cart-decision-tree.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(tree)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-72-2.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cart-decision-tree.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print confusion matrix of your model on training dataset</span></span>
<span id="cb81-2"><a href="cart-decision-tree.html#cb81-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, train, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb81-3"><a href="cart-decision-tree.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(p, train<span class="sc">$</span>yesno, <span class="at">positive=</span><span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction    n    y
##          n 1278  212
##          y  127  688
##                                           
##                Accuracy : 0.8529          
##                  95% CI : (0.8378, 0.8671)
##     No Information Rate : 0.6095          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.6857          
##                                           
##  Mcnemar&#39;s Test P-Value : 5.061e-06       
##                                           
##             Sensitivity : 0.7644          
##             Specificity : 0.9096          
##          Pos Pred Value : 0.8442          
##          Neg Pred Value : 0.8577          
##              Prevalence : 0.3905          
##          Detection Rate : 0.2985          
##    Detection Prevalence : 0.3536          
##       Balanced Accuracy : 0.8370          
##                                           
##        &#39;Positive&#39; Class : y               
## </code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cart-decision-tree.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve</span></span>
<span id="cb83-2"><a href="cart-decision-tree.html#cb83-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, test, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb83-3"><a href="cart-decision-tree.html#cb83-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1[,<span class="dv">2</span>] <span class="co"># extract y information</span></span>
<span id="cb83-4"><a href="cart-decision-tree.html#cb83-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">multiclass.roc</span>(test<span class="sc">$</span>yesno, p1, <span class="at">percent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-5"><a href="cart-decision-tree.html#cb83-5" aria-hidden="true" tabindex="-1"></a>roc <span class="ot">&lt;-</span> r[[<span class="st">&quot;rocs&quot;</span>]]</span>
<span id="cb83-6"><a href="cart-decision-tree.html#cb83-6" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> roc[[<span class="dv">1</span>]]</span>
<span id="cb83-7"><a href="cart-decision-tree.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(</span>
<span id="cb83-8"><a href="cart-decision-tree.html#cb83-8" aria-hidden="true" tabindex="-1"></a>    r1,</span>
<span id="cb83-9"><a href="cart-decision-tree.html#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">print.auc =</span> <span class="cn">TRUE</span>,</span>
<span id="cb83-10"><a href="cart-decision-tree.html#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc.polygon =</span> <span class="cn">TRUE</span>,</span>
<span id="cb83-11"><a href="cart-decision-tree.html#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>),</span>
<span id="cb83-12"><a href="cart-decision-tree.html#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid.col =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb83-13"><a href="cart-decision-tree.html#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.auc.polygon =</span> <span class="cn">TRUE</span>,</span>
<span id="cb83-14"><a href="cart-decision-tree.html#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc.polygon.col =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb83-15"><a href="cart-decision-tree.html#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">print.thres =</span> <span class="cn">TRUE</span>,</span>
<span id="cb83-16"><a href="cart-decision-tree.html#cb83-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;ROC Curve&quot;</span></span>
<span id="cb83-17"><a href="cart-decision-tree.html#cb83-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-74-1.png" width="672" />
## Regression Tree</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cart-decision-tree.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;BostonHousing&quot;</span>)</span>
<span id="cb84-2"><a href="cart-decision-tree.html#cb84-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> BostonHousing</span>
<span id="cb84-3"><a href="cart-decision-tree.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mydata)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    506 obs. of  14 variables:
##  $ crim   : num  0.00632 0.02731 0.02729 0.03237 0.06905 ...
##  $ zn     : num  18 0 0 0 0 0 12.5 12.5 12.5 12.5 ...
##  $ indus  : num  2.31 7.07 7.07 2.18 2.18 2.18 7.87 7.87 7.87 7.87 ...
##  $ chas   : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ nox    : num  0.538 0.469 0.469 0.458 0.458 0.458 0.524 0.524 0.524 0.524 ...
##  $ rm     : num  6.58 6.42 7.18 7 7.15 ...
##  $ age    : num  65.2 78.9 61.1 45.8 54.2 58.7 66.6 96.1 100 85.9 ...
##  $ dis    : num  4.09 4.97 4.97 6.06 6.06 ...
##  $ rad    : num  1 2 2 3 3 3 5 5 5 5 ...
##  $ tax    : num  296 242 242 222 222 222 311 311 311 311 ...
##  $ ptratio: num  15.3 17.8 17.8 18.7 18.7 18.7 15.2 15.2 15.2 15.2 ...
##  $ b      : num  397 397 393 395 397 ...
##  $ lstat  : num  4.98 9.14 4.03 2.94 5.33 ...
##  $ medv   : num  24 21.6 34.7 33.4 36.2 28.7 22.9 27.1 16.5 18.9 ...</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="cart-decision-tree.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data partition</span></span>
<span id="cb86-2"><a href="cart-decision-tree.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb86-3"><a href="cart-decision-tree.html#cb86-3" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(mydata), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb86-4"><a href="cart-decision-tree.html#cb86-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> mydata[ind <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb86-5"><a href="cart-decision-tree.html#cb86-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> mydata[ind <span class="sc">==</span> <span class="dv">2</span>,]</span>
<span id="cb86-6"><a href="cart-decision-tree.html#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="cart-decision-tree.html#cb86-7" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(medv <span class="sc">~</span>., <span class="at">data =</span> train)</span>
<span id="cb86-8"><a href="cart-decision-tree.html#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cart-decision-tree.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(tree)</span></code></pre></div>
<pre><code>## 
## Regression tree:
## rpart(formula = medv ~ ., data = train)
## 
## Variables actually used in tree construction:
## [1] age   crim  lstat rm   
## 
## Root node error: 22620/262 = 86.334
## 
## n= 262 
## 
##         CP nsplit rel error  xerror
## 1 0.469231      0   1.00000 1.01139
## 2 0.128700      1   0.53077 0.62346
## 3 0.098630      2   0.40207 0.51042
## 4 0.033799      3   0.30344 0.42674
## 5 0.028885      4   0.26964 0.39232
## 6 0.028018      5   0.24075 0.37848
## 7 0.015141      6   0.21274 0.34877
## 8 0.010000      7   0.19760 0.33707
##       xstd
## 1 0.115186
## 2 0.080154
## 3 0.076055
## 4 0.069827
## 5 0.066342
## 6 0.066389
## 7 0.065824
## 8 0.065641</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="cart-decision-tree.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(tree)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-76-2.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="cart-decision-tree.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb90-2"><a href="cart-decision-tree.html#cb90-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree, train)</span>
<span id="cb90-3"><a href="cart-decision-tree.html#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="cart-decision-tree.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb90-5"><a href="cart-decision-tree.html#cb90-5" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sqrt</span>(<span class="fu">mean</span>((train<span class="sc">$</span>medv <span class="sc">-</span> p)<span class="sc">^</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] 4.130294</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="cart-decision-tree.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R squared</span></span>
<span id="cb92-2"><a href="cart-decision-tree.html#cb92-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">cor</span>(train<span class="sc">$</span>medv, p))<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.8024039</code></pre>
<p>In the regression model, the r square value is 80% and RMSE is 4.13, not bad at all.. In this way, you can make use of Decision classification regression tree models.</p>
</div>
<div id="random-forest" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Random Forest</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="cart-decision-tree.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench)</span>
<span id="cb94-2"><a href="cart-decision-tree.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Sonar)</span>
<span id="cb94-3"><a href="cart-decision-tree.html#cb94-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">head</span>(Sonar))</span></code></pre></div>
<pre><code>##       V1     V2     V3     V4     V5
## 1 0.0200 0.0371 0.0428 0.0207 0.0954
## 2 0.0453 0.0523 0.0843 0.0689 0.1183
## 3 0.0262 0.0582 0.1099 0.1083 0.0974
## 4 0.0100 0.0171 0.0623 0.0205 0.0205
## 5 0.0762 0.0666 0.0481 0.0394 0.0590
## 6 0.0286 0.0453 0.0277 0.0174 0.0384
##       V6     V7     V8     V9    V10
## 1 0.0986 0.1539 0.1601 0.3109 0.2111
## 2 0.2583 0.2156 0.3481 0.3337 0.2872
## 3 0.2280 0.2431 0.3771 0.5598 0.6194
## 4 0.0368 0.1098 0.1276 0.0598 0.1264
## 5 0.0649 0.1209 0.2467 0.3564 0.4459
## 6 0.0990 0.1201 0.1833 0.2105 0.3039
##      V11    V12    V13    V14    V15
## 1 0.1609 0.1582 0.2238 0.0645 0.0660
## 2 0.4918 0.6552 0.6919 0.7797 0.7464
## 3 0.6333 0.7060 0.5544 0.5320 0.6479
## 4 0.0881 0.1992 0.0184 0.2261 0.1729
## 5 0.4152 0.3952 0.4256 0.4135 0.4528
## 6 0.2988 0.4250 0.6343 0.8198 1.0000
##      V16    V17    V18    V19    V20
## 1 0.2273 0.3100 0.2999 0.5078 0.4797
## 2 0.9444 1.0000 0.8874 0.8024 0.7818
## 3 0.6931 0.6759 0.7551 0.8929 0.8619
## 4 0.2131 0.0693 0.2281 0.4060 0.3973
## 5 0.5326 0.7306 0.6193 0.2032 0.4636
## 6 0.9988 0.9508 0.9025 0.7234 0.5122
##      V21    V22    V23    V24    V25
## 1 0.5783 0.5071 0.4328 0.5550 0.6711
## 2 0.5212 0.4052 0.3957 0.3914 0.3250
## 3 0.7974 0.6737 0.4293 0.3648 0.5331
## 4 0.2741 0.3690 0.5556 0.4846 0.3140
## 5 0.4148 0.4292 0.5730 0.5399 0.3161
## 6 0.2074 0.3985 0.5890 0.2872 0.2043
##      V26    V27    V28    V29    V30
## 1 0.6415 0.7104 0.8080 0.6791 0.3857
## 2 0.3200 0.3271 0.2767 0.4423 0.2028
## 3 0.2413 0.5070 0.8533 0.6036 0.8514
## 4 0.5334 0.5256 0.2520 0.2090 0.3559
## 5 0.2285 0.6995 1.0000 0.7262 0.4724
## 6 0.5782 0.5389 0.3750 0.3411 0.5067
##      V31    V32    V33    V34    V35
## 1 0.1307 0.2604 0.5121 0.7547 0.8537
## 2 0.3788 0.2947 0.1984 0.2341 0.1306
## 3 0.8512 0.5045 0.1862 0.2709 0.4232
## 4 0.6260 0.7340 0.6120 0.3497 0.3953
## 5 0.5103 0.5459 0.2881 0.0981 0.1951
## 6 0.5580 0.4778 0.3299 0.2198 0.1407
##      V36    V37    V38    V39    V40
## 1 0.8507 0.6692 0.6097 0.4943 0.2744
## 2 0.4182 0.3835 0.1057 0.1840 0.1970
## 3 0.3043 0.6116 0.6756 0.5375 0.4719
## 4 0.3012 0.5408 0.8814 0.9857 0.9167
## 5 0.4181 0.4604 0.3217 0.2828 0.2430
## 6 0.2856 0.3807 0.4158 0.4054 0.3296
##      V41    V42    V43    V44    V45
## 1 0.0510 0.2834 0.2825 0.4256 0.2641
## 2 0.1674 0.0583 0.1401 0.1628 0.0621
## 3 0.4647 0.2587 0.2129 0.2222 0.2111
## 4 0.6121 0.5006 0.3210 0.3202 0.4295
## 5 0.1979 0.2444 0.1847 0.0841 0.0692
## 6 0.2707 0.2650 0.0723 0.1238 0.1192
##      V46    V47    V48    V49    V50
## 1 0.1386 0.1051 0.1343 0.0383 0.0324
## 2 0.0203 0.0530 0.0742 0.0409 0.0061
## 3 0.0176 0.1348 0.0744 0.0130 0.0106
## 4 0.3654 0.2655 0.1576 0.0681 0.0294
## 5 0.0528 0.0357 0.0085 0.0230 0.0046
## 6 0.1089 0.0623 0.0494 0.0264 0.0081
##      V51    V52    V53    V54    V55
## 1 0.0232 0.0027 0.0065 0.0159 0.0072
## 2 0.0125 0.0084 0.0089 0.0048 0.0094
## 3 0.0033 0.0232 0.0166 0.0095 0.0180
## 4 0.0241 0.0121 0.0036 0.0150 0.0085
## 5 0.0156 0.0031 0.0054 0.0105 0.0110
## 6 0.0104 0.0045 0.0014 0.0038 0.0013
##      V56    V57    V58    V59    V60 Class
## 1 0.0167 0.0180 0.0084 0.0090 0.0032     R
## 2 0.0191 0.0140 0.0049 0.0052 0.0044     R
## 3 0.0244 0.0316 0.0164 0.0095 0.0078     R
## 4 0.0073 0.0050 0.0044 0.0040 0.0117     R
## 5 0.0015 0.0072 0.0048 0.0107 0.0094     R
## 6 0.0089 0.0057 0.0027 0.0051 0.0062     R</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="cart-decision-tree.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb96-2"><a href="cart-decision-tree.html#cb96-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb96-3"><a href="cart-decision-tree.html#cb96-3" aria-hidden="true" tabindex="-1"></a>    Class <span class="sc">~</span>.,</span>
<span id="cb96-4"><a href="cart-decision-tree.html#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Sonar,</span>
<span id="cb96-5"><a href="cart-decision-tree.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span></span>
<span id="cb96-6"><a href="cart-decision-tree.html#cb96-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="cart-decision-tree.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 208 samples
##  60 predictor
##   2 classes: &#39;M&#39;, &#39;R&#39; 
## 
## No pre-processing
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 208, 208, 208, 208, 208, 208, ... 
## Resampling results across tuning parameters:
## 
##   mtry  splitrule   Accuracy   Kappa    
##    2    gini        0.8078699  0.6108857
##    2    extratrees  0.8188579  0.6341083
##   31    gini        0.7751013  0.5455448
##   31    extratrees  0.8275348  0.6496807
##   60    gini        0.7676651  0.5302055
##   60    extratrees  0.8221403  0.6387246
## 
## Tuning parameter &#39;min.node.size&#39; was
##  held constant at a value of 1
## Accuracy was used to select the
##  optimal model using the largest value.
## The final values used for the model
##  were mtry = 31, splitrule =
##  extratrees and min.node.size = 1.</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="cart-decision-tree.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-80-1.png" width="672" />
Tune hyperparameters:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="cart-decision-tree.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb100-2"><a href="cart-decision-tree.html#cb100-2" aria-hidden="true" tabindex="-1"></a>myGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb100-3"><a href="cart-decision-tree.html#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>),</span>
<span id="cb100-4"><a href="cart-decision-tree.html#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">splitrule=</span><span class="fu">c</span>(<span class="st">&quot;gini&quot;</span>, <span class="st">&quot;extratrees&quot;</span>),</span>
<span id="cb100-5"><a href="cart-decision-tree.html#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.node.size =</span> <span class="dv">1</span></span>
<span id="cb100-6"><a href="cart-decision-tree.html#cb100-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-7"><a href="cart-decision-tree.html#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="cart-decision-tree.html#cb100-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb100-9"><a href="cart-decision-tree.html#cb100-9" aria-hidden="true" tabindex="-1"></a>    Class <span class="sc">~</span> .,</span>
<span id="cb100-10"><a href="cart-decision-tree.html#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Sonar,</span>
<span id="cb100-11"><a href="cart-decision-tree.html#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb100-12"><a href="cart-decision-tree.html#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> myGrid,</span>
<span id="cb100-13"><a href="cart-decision-tree.html#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb100-14"><a href="cart-decision-tree.html#cb100-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;cv&quot;</span>,</span>
<span id="cb100-15"><a href="cart-decision-tree.html#cb100-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb100-16"><a href="cart-decision-tree.html#cb100-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">verboseIter =</span> <span class="cn">FALSE</span></span>
<span id="cb100-17"><a href="cart-decision-tree.html#cb100-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb100-18"><a href="cart-decision-tree.html#cb100-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-19"><a href="cart-decision-tree.html#cb100-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-20"><a href="cart-decision-tree.html#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 208 samples
##  60 predictor
##   2 classes: &#39;M&#39;, &#39;R&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 166, 167, 167, 167, 165 
## Resampling results across tuning parameters:
## 
##   mtry  splitrule   Accuracy   Kappa    
##    5    gini        0.8173838  0.6297111
##    5    extratrees  0.8273668  0.6497566
##   10    gini        0.8171569  0.6305735
##   10    extratrees  0.8414310  0.6791146
##   20    gini        0.7978716  0.5908457
##   20    extratrees  0.8417740  0.6792866
##   40    gini        0.7879994  0.5727742
##   40    extratrees  0.8466467  0.6897164
##   60    gini        0.7928774  0.5822691
##   60    extratrees  0.8608271  0.7187262
## 
## Tuning parameter &#39;min.node.size&#39; was
##  held constant at a value of 1
## Accuracy was used to select the
##  optimal model using the largest value.
## The final values used for the model
##  were mtry = 60, splitrule =
##  extratrees and min.node.size = 1.</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="cart-decision-tree.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code></pre></div>
<p><img src="R-Algorithm-Notes_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="knn-k-nearest-neighbors.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-cart.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R Algorithm Notes.pdf", "R Algorithm Notes.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
